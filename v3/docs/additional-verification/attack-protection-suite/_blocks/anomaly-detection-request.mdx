import { H2, H3, H4 } from "/src/components/Typography";
import { HTTPRequestCard } from "/src/components/Cards";

<HTTPRequestCard.DetailsModalHeader>
  <HTTPRequestCard.DetailsModalDescription>
    Checks for suspicious activity and potential security threats during authentication events.
  </HTTPRequestCard.DetailsModalDescription>
  <HTTPRequestCard.DetailsModalDescription>
    **Authorization**: Set the `Authorization` header to `Bearer <secret-api-key>` where `<secret-api-key>` is your SuperTokens Attack Protection Suite API key.
  </HTTPRequestCard.DetailsModalDescription>
</HTTPRequestCard.DetailsModalHeader>

<HTTPRequestCard.DetailsModalBody>

<H2>Request</H2>

<H3>Body Schema</H3>

| Name         | Type                         | Description                                                                                                                                                              | Required |
| ------------ | ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |
| email        | `string`                     | User's email address. If omitted (along with phoneNumber), impossible travel detection, new device detection and device count detection will be skipped.                 | No       |
| phoneNumber  | `string`                     | User's phone number. If omitted (along with email), impossible travel detection, new device detection and device count detection will be skipped.                        | No       |
| passwordHash | `string`                     | First 5 characters of the SHA-1 hash of the password. If omitted, password breach check will be skipped.                                                                 | No       |
| requestId    | `string`                     | Frontend-generated request ID. If omitted, bot detection, impossible travel detection, new device detection, device count detection and request ID info will be skipped. | No       |
| actionType   | `string`                     | Type of authentication action being performed                                                                                                                            | No       |
| bruteForce   | `array` of `BruteForceCheck` | Configuration for brute force detection                                                                                                                                  | No       |

<H4>BruteForceCheck</H4>

| Name        | Type                    | Description                                                        | Required |
| ----------- | ----------------------- | ------------------------------------------------------------------ | -------- |
| key         | `string`                | Unique identifier for rate limiting (e.g. email, phone number, IP) | Yes      |
| maxRequests | `array` of `MaxRequest` | Rate limit rules                                                   | Yes      |

<H4>MaxRequest</H4>

| Name              | Type     | Description                        | Required |
| ----------------- | -------- | ---------------------------------- | -------- |
| limit             | `number` | Maximum number of requests allowed | Yes      |
| perTimeIntervalMS | `number` | Time window in milliseconds        | Yes      |

<H3>Action Types</H3>

The following action types are supported:

- `emailpassword-sign-in`: Email password sign in attempt
- `emailpassword-sign-up`: Email password sign up attempt
- `send-password-reset-email`: Password reset email request
- `passwordless-send-email`: Passwordless email code/link
- `passwordless-send-sms`: Passwordless SMS code
- `totp-verify-device`: TOTP device verification
- `totp-verify-totp`: TOTP code verification
- `thirdparty-login`: Third-party provider login
- `emailverification-send-email`: Email verification request

<H3>Example</H3>

```bash
curl --location --request POST 'https://security-us-east-1.aws.supertokens.io/v1/security' \
     --header 'Authorization: Bearer <secret-api-key>' \
     --header 'Content-Type: application/json' \
     --data-raw '{
    "email": "user@email.com",
    "phoneNumber": "+1234567890",
    "passwordHash": "9cf95dacd226dcf43da376cdb6cbba7035218920",
    "requestId": "some-request-id",
    "actionType": "emailpassword-sign-in",
    "bruteForce": [
        {
            "key": "some-key",
            "maxRequests": [
                {
                    "limit": 1,
                    "perTimeIntervalMS": 1000
                }
            ]
        }
    ]
}'
```

<H2>Response</H2>

<H3>200</H3>

Returns the anomaly detection results.

<H4>Response Schema</H4>

| Name                         | Type      | Description                                                                |
| ---------------------------- | --------- | -------------------------------------------------------------------------- |
| id                           | `string`  | Unique identifier for the anomaly detection check                          |
| bruteForce                   | `object`  | Brute force detection results                                              |
| emailRisk                    | `object`  | Email risk assessment results                                              |
| phoneNumberRisk              | `object`  | Phone number risk assessment results                                       |
| passwordBreaches             | `object`  | Password breach check results                                              |
| isNewDevice                  | `boolean` | Whether this is a new device for the user                                  |
| isImpossibleTravel           | `boolean` | Whether impossible travel was detected                                     |
| numberOfUniqueDevicesForUser | `number`  | Number of unique devices used by the user                                  |
| requestIdInfo                | `object`  | Information about the request including VPN detection, bot detection, etc. |

<H4>Example</H4>

```json
{
  "id": "0191bc35-d527-7bbd-88df-1e7669e82cc0",
  "bruteForce": {
    "detected": true,
    "key": "some-key"
  },
  "emailRisk": null,
  "phoneNumberRisk": null,
  "passwordBreaches": {
    "c1d808e04732adf679965ccc34ca7ae3441": "120",
    "7acba4f54f55aafc33bb06bbbf6ca803e9a": "399"
  },
  "isNewDevice": false,
  "isImpossibleTravel": false,
  "numberOfUniqueDevicesForUser": 1,
  "requestIdInfo": {
    "vpn": {
      "result": true,
      "methods": {
        "publicVPN": true,
        "osMismatch": false,
        "auxiliaryMobile": false,
        "timezoneMismatch": true
      },
      "originCountry": "unknown",
      "originTimezone": "Europe/Bucharest"
    },
    "frida": false,
    "proxy": false,
    "valid": true,
    "botDetected": false,
    "isUsingTor": false
  }
}
```

<H3>400</H3>

The request was invalid.

<H4>Example</H4>

```json
{
  "error": "Invalid request body"
}
```

<H3>401</H3>

Invalid or missing API key.

<H4>Example</H4>

```json
{
  "error": "Unauthorized"
}
```

<H3>500</H3>

An internal server error occurred.

</HTTPRequestCard.DetailsModalBody>
