---
sidebar_position: 2
title: Initial setup
toc_max_heading_level: 4
hide_title: true
description: Set up Attack Protection Suite in your **SuperTokens** integration
---

# Initial setup

## Overview

## Before you start

This feature is **currently in beta**. In order to get access to this feature, please reach out to us at support@supertokens.com to get it setup for you. 

Once you have access to the feature, you will receive from us:
- **Public API key** - this will be used on your frontend for generating request IDs
- **Secret API key** - this will be used on your backend for making requests to our anomaly detection API
- **Environment ID** - this will be used for identifying the environment you are using both on the backend and the frontend

The frontend setup is required only for bot detection and anomaly IP based detection such as impossible travel detection.
We also recommend checking for bot detection only on the email password login flows.

## Steps

### 1. Attach request IDs to backend API calls

The **Attack Protection Suite** feature relies on identifying each request through a unique ID.
This way the fingerprinting process can determine if it's a potential threat or not.

#### 1.1 Generate a request ID 

To generate a request ID, import and initialise the SDK using your public API key.
This SDK is used to generate a unique request ID for each authentication event attempt.

```tsx
const ENVIRONMENT_ID = "<environment-id>"; // Your environment ID that you received from the SuperTokens team
// Initialize the agent on page load using your public API key that you received from the SuperTokens team.
const supertokensRequestIdPromise = require("https://deviceid.supertokens.io/PqWNQ35Ydhm6WDUK/k9bwGCuvuA83Ad6s?apiKey=<PUBLIC_API_KEY>")
    .then((RequestId: any) => RequestId.load({
        endpoint: [
            'https://deviceid.supertokens.io/PqWNQ35Ydhm6WDUK/CnsdzKsyFKU8Q3h2',
            RequestId.defaultEndpoint
        ]
    }));

async function getRequestId() {
    const sdk = await supertokensRequestIdPromise;
    const result = await sdk.get({
        tag: {
            environmentId: ENVIRONMENT_ID,
        }
    });
    return result.requestId;
}
```

:::info Note
Make sure to replace the `<PUBLIC_API_KEY>` in the above string with the provided public API key.
:::

#### 1.2 Pass the request ID to the backend

Include the `requestId` property along with the value as part of the `preAPIHook` body from the initialisation of the recipes.

:::info Important
If the request ID is not passed to the backend, the anomaly detection will only be able to detect password breaches and brute force attacks.
:::

Below is a full example of how to configure the SDK and pass the request ID to the backend.
The request ID is being generated only for the email password sign in, sign up and reset password actions because these are the only actions that require bot detection.
For all the other recipes, this is not needed.

```tsx
import EmailPassword from "supertokens-auth-react/recipe/emailpassword";

const ENVIRONMENT_ID = "<environment-id>"; // Your environment ID that you received from the SuperTokens team
// Initialize the agent on page load using your public API key that you received from the SuperTokens team.
const supertokensRequestIdPromise = require("https://deviceid.supertokens.io/PqWNQ35Ydhm6WDUK/k9bwGCuvuA83Ad6s?apiKey=<PUBLIC_API_KEY>")
    .then((RequestId: any) => RequestId.load({
        endpoint: [
            'https://deviceid.supertokens.io/PqWNQ35Ydhm6WDUK/CnsdzKsyFKU8Q3h2',
            RequestId.defaultEndpoint
        ]
    }));

async function getRequestId() {
    const sdk = await supertokensRequestIdPromise;
    const result = await sdk.get({
        tag: {
            environmentId: ENVIRONMENT_ID,
        }
    });
    return result.requestId;
}

export const SuperTokensConfig = {
    // ... other config options
    appInfo: {
        appName: "...",
        apiDomain: '...',
        websiteDomain: '...',
    },
    // recipeList contains all the modules that you want to
    // use from SuperTokens. See the full list here: https://supertokens.com/docs/guides
    recipeList: [
        EmailPassword.init({
            // highlight-start
            preAPIHook: async (context) => {
                let url = context.url;
                let requestInit = context.requestInit;

                let action = context.action;
                if (action === "EMAIL_PASSWORD_SIGN_IN" || action === "EMAIL_PASSWORD_SIGN_UP" || action === "SEND_RESET_PASSWORD_EMAIL") {
                    let requestId = await getRequestId();
                    let body = context.requestInit.body;
                    if (body !== undefined) {
                        let bodyJson = JSON.parse(body as string);
                        bodyJson.requestId = requestId;
                        requestInit.body = JSON.stringify(bodyJson);
                    }
                }
                return {
                    requestInit, url
                };
            }
            // highlight-end
        }),
    ],
};
```

### 2. Call the protection service from the backend




