---
id: pre-api
title: Pre API Hook
hide_title: true
sidebar_position: 1
description: >-
  Customize API requests by modifying request properties before they reach your
  backend.
---

import {
  FrontendPrebuiltUITabs,
  FrontendCustomUITabs,
} from "/src/components/Tabs";
import { NpmOrScriptsCard, MobileFrameworksCard } from "/src/components/Cards";

# Pre API Hook

This function is called before any API call is being made to your backend from our frontend SDK. You can use this to change the request body / url / header or any other request property.

<UIType.Switch />

<UIType.PrebuiltUIContent>

<FrontendPrebuiltUITabs>
<FrontendPrebuiltUITabs.TabItem value="reactjs">

```tsx
import ThirdParty from "supertokens-auth-react/recipe/thirdparty";
import EmailPassword from "supertokens-auth-react/recipe/emailpassword";

ThirdParty.init({
    preAPIHook: async (context) => {
        let url = context.url;
        let requestInit = context.requestInit;
        
        let action = context.action;
        if (action === "GET_AUTHORISATION_URL") {

        } else if (action === "THIRD_PARTY_SIGN_IN_UP") {
             // Note: this could either be sign in or sign up.
             // we don't know that at the time of the API call
             // since all we have is the authorisation code from
             // the social provider
        }

        // events such as sign out are in the 
        // session recipe pre API hook (See the info box below)

        return {
            requestInit, url
        };

    }
})

EmailPassword.init({
    preAPIHook: async (context) => {
        let url = context.url;
        let requestInit = context.requestInit;
        
        let action = context.action;
        if (action === "EMAIL_EXISTS") {

        } else if (action === "EMAIL_PASSWORD_SIGN_IN") {

        } else if (action === "EMAIL_PASSWORD_SIGN_UP") {

        } else if (action === "SEND_RESET_PASSWORD_EMAIL") {

        } else if (action === "SUBMIT_NEW_PASSWORD") {

        }

        // events such as sign out are in the 
        // session recipe pre API hook (See the info box below)

        return {
            requestInit, url
        };

    }
})
```

</FrontendPrebuiltUITabs.TabItem>

<FrontendPrebuiltUITabs.TabItem value="angular">

```tsx
// this goes in the auth route config of your frontend app (once the pre-built UI script has been loaded)
import supertokensUIThirdParty from "supertokens-auth-react-script/recipe/thirdparty";
import supertokensUIEmailPassword from "supertokens-auth-react-script/recipe/emailpassword";

supertokensUIThirdParty.init({
    preAPIHook: async (context) => {
        let url = context.url;
        let requestInit = context.requestInit;
        
        let action = context.action;
        if (action === "GET_AUTHORISATION_URL") {

        } else if (action === "THIRD_PARTY_SIGN_IN_UP") {
             // Note: this could either be sign in or sign up.
             // we don't know that at the time of the API call
             // since all we have is the authorisation code from
             // the social provider
        }

        // events such as sign out are in the 
        // session recipe pre API hook (See the info box below)

        return {
            requestInit, url
        };

    }
})

supertokensUIEmailPassword.init({
    preAPIHook: async (context) => {
        let url = context.url;
        let requestInit = context.requestInit;
        
        let action = context.action;
        if (action === "EMAIL_EXISTS") {

        } else if (action === "EMAIL_PASSWORD_SIGN_IN") {

        } else if (action === "EMAIL_PASSWORD_SIGN_UP") {

        } else if (action === "SEND_RESET_PASSWORD_EMAIL") {

        } else if (action === "SUBMIT_NEW_PASSWORD") {

        }

        // events such as sign out are in the 
        // session recipe pre API hook (See the info box below)

        return {
            requestInit, url
        };

    }
})
```

</FrontendPrebuiltUITabs.TabItem>

</FrontendPrebuiltUITabs>

</UIType.PrebuiltUIContent>

<UIType.CustomUIContent>

<FrontendCustomUITabs>
<FrontendCustomUITabs.TabItem value="web">

<NpmOrScriptsCard>
<NpmOrScriptsCard.Content value="npm">

```tsx
import ThirdParty from "supertokens-web-js/recipe/thirdparty"
import EmailPassword from "supertokens-web-js/recipe/emailpassword"

EmailPassword.init({
    preAPIHook: async (context) => {
        let url = context.url;
        let requestInit = context.requestInit;
        
        let action = context.action;
        if (action === "EMAIL_EXISTS") {

        } else if (action === "EMAIL_PASSWORD_SIGN_IN") {

        } else if (action === "EMAIL_PASSWORD_SIGN_UP") {

        } else if (action === "SEND_RESET_PASSWORD_EMAIL") {

        } else if (action === "SUBMIT_NEW_PASSWORD") {

        }

        // events such as sign out are in the 
        // session recipe pre API hook (See the info box below)

        return {
            requestInit, url
        };
    },
})

ThirdParty.init({
    preAPIHook: async (context) => {
        let url = context.url;
        let requestInit = context.requestInit;
        
        let action = context.action;
        if (action === "GET_AUTHORISATION_URL") {

        } else if (action === "THIRD_PARTY_SIGN_IN_UP") {
             // Note: this could either be sign in or sign up.
             // we don't know that at the time of the API call
             // since all we have is the authorisation code from
             // the social provider
        }

        // events such as sign out are in the 
        // session recipe pre API hook (See the info box below)

        return {
            requestInit, url
        };
    },
})
```

Alternatively you could also declare the pre-api hook when calling the function:

```tsx
import EmailPassword  from "supertokens-web-js/recipe/emailpassword"

EmailPassword.doesEmailExist({
    email: "...",
    options: {
        preAPIHook: async (input) => {

            let url = input.url
            let requestInit = input.requestInit

            // TODO: add your code here

            return {url, requestInit}; 
        },
    }
});
```

</NpmOrScriptsCard.Content>
<NpmOrScriptsCard.Content value="scripts">

```tsx
import supertokensThirdParty from "supertokens-web-js-script/recipe/thirdparty";
import supertokensEmailPassword from "supertokens-web-js-script/recipe/emailpassword";
supertokensEmailPassword.init({
    preAPIHook: async (context) => {
        let url = context.url;
        let requestInit = context.requestInit;
        
        let action = context.action;
        if (action === "EMAIL_EXISTS") {

        } else if (action === "EMAIL_PASSWORD_SIGN_IN") {

        } else if (action === "EMAIL_PASSWORD_SIGN_UP") {

        } else if (action === "SEND_RESET_PASSWORD_EMAIL") {

        } else if (action === "SUBMIT_NEW_PASSWORD") {

        }

        // events such as sign out are in the 
        // session recipe pre API hook (See the info box below)

        return {
            requestInit, url
        };
    },
})

supertokensThirdParty.init({
    preAPIHook: async (context) => {
        let url = context.url;
        let requestInit = context.requestInit;
        
        let action = context.action;
        if (action === "GET_AUTHORISATION_URL") {

        } else if (action === "THIRD_PARTY_SIGN_IN_UP") {
             // Note: this could either be sign in or sign up.
             // we don't know that at the time of the API call
             // since all we have is the authorisation code from
             // the social provider
        }

        // events such as sign out are in the 
        // session recipe pre API hook (See the info box below)

        return {
            requestInit, url
        };
    },
})
```

Alternatively you could also declare the pre-api hook when calling the function:

```tsx
import supertokensEmailPassword  from "supertokens-web-js-script/recipe/emailpassword"
supertokensEmailPassword.doesEmailExist({
    email: "...",
    options: {
        preAPIHook: async (input) => {

            let url = input.url
            let requestInit = input.requestInit

            return {url, requestInit}; 
        },
    }
});

```

</NpmOrScriptsCard.Content>
</NpmOrScriptsCard>

:::info
Also checkout the [session recipe pre API hook](/docs/session/advanced-customizations/frontend-hooks/pre-api) for events such as sign out. These will need to go in the `Session.init` config object.
:::

</FrontendCustomUITabs.TabItem>

<FrontendCustomUITabs.TabItem value="mobile">

<MobileFrameworksCard>

<MobileFrameworksCard.Content value="reactnative">

```tsx
import SuperTokens from "supertokens-react-native";

SuperTokens.init({
  apiDomain: "...",
  preAPIHook: async (context) => {
    let requestInit = context.requestInit;

    if (context.action === "REFRESH_SESSION") {
      requestInit.headers = {
        ...requestInit.headers,
        customHeader: "custom-header",
      };
    } else if (context.action === "SIGN_OUT") {
      requestInit.headers = {
        ...requestInit.headers,
        customHeader: "custom-header",
      };
    }

    return {
      ...context,
      requestInit,
    };
  },
});

```

</MobileFrameworksCard.Content>

<MobileFrameworksCard.Content value="android">

```kotlin
import android.app.Application
import com.supertokens.session.CustomHeaderProvider
import com.supertokens.session.SuperTokens

class MainApplication : Application() {
    override fun onCreate() {
        super.onCreate()
        SuperTokens.Builder(applicationContext, "...").customHeaderProvider(object : CustomHeaderProvider {
            override fun getRequestHeaders(requestType: CustomHeaderProvider.RequestType?): MutableMap<String, String> {
                var headers: MutableMap<String, String> = HashMap()

                if (requestType == CustomHeaderProvider.RequestType.REFRESH) {
                    headers["custom-header"] = "custom-value"
                } else if (requestType == CustomHeaderProvider.RequestType.SIGN_OUT) {
                    headers["custom-header"] = "custom-value"
                }

                return headers
            }
        }).build()
    }
}
```

</MobileFrameworksCard.Content>

<MobileFrameworksCard.Content value="ios">

```swift
import UIKit
import SuperTokensIOS

fileprivate class MyApplicationDelegate: UIResponder, UIApplicationDelegate {
    
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
        do {
            try SuperTokens.initialize(
                apiDomain: "...",
                preAPIHook: {
                  action, request in

                  let mutableRequest = (request as NSURLRequest).mutableCopy() as! NSMutableURLRequest

                  if action == .REFRESH_SESSION {
                    mutableRequest.addValue("custom-value", forHTTPHeaderField: "custom-header")
                  }
                  
                  if action == .SIGN_OUT {
                    mutableRequest.addValue("custom-value", forHTTPHeaderField: "custom-header")
                  }

                  return mutableRequest.copy() as! URLRequest
                }
            )
        } catch SuperTokensError.initError(let message) {
            // TODO: Handle initialization error
        } catch {
            // Some other error
        }

        return true
    }
    
}
```

</MobileFrameworksCard.Content>

<MobileFrameworksCard.Content value="flutter">

```dart
import 'package:supertokens_flutter/supertokens.dart';

void main() {
    SuperTokens.init(
    apiDomain: "...",
    preAPIHook: (action, req) {
      if (action == APIAction.SIGN_OUT) {
        req.headers["custom-header"] = "custom-value";
      } else if (action == APIAction.REFRESH_TOKEN) {
        req.headers["custom-header"] = "custom-value";
      }
      
      return req;
    },
  );
}
```

</MobileFrameworksCard.Content>

</MobileFrameworksCard>

</FrontendCustomUITabs.TabItem>

</FrontendCustomUITabs>

</UIType.CustomUIContent>

## Reading custom request information in the backend

Visit [this page](/docs/references/sdks/custom-request-properties) to learn how to read custom headers etc from the request on the backend.
