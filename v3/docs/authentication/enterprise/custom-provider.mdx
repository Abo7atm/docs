---
id: custom-provider
title: Add a custom third-party provider
hide_title: true
sidebar_position: 6
description: >-
  Add custom third-party providers to tenants using OAuth or OpenID Connect
  endpoints.
---

import { BackendTabs } from "/src/components/Tabs";
import { PythonSyncAsyncCard } from "/src/components/Cards";


# Add a custom third-party provider

**SuperTokens** exposes [several built-in providers](/docs/authentication/social/built-in-providers-config).
With that in mind, there are cases where you may want to add your own provider.
This page shows you how to do that on a per tenant basis.

Once you have [created a tenant](./new-tenant-config), you want to call the API / function to create a new provider for the tenant as shown below:

## Via OAuth Endpoints

<BackendTabs additionalValues={[{ value: "dashboard", label: "Dashboard" }, { value: "curl", label: "cURL" }]}>

<BackendTabs.TabItem value="nodejs">

```tsx
import Multiteancy from "supertokens-node/recipe/multitenancy";

async function createTenant() {
    let resp = await Multiteancy.createOrUpdateThirdPartyConfig("customer1", {
        thirdPartyId: "custom",
        name: "Custom Provider",
        clients: [{
            clientId: "...",
            clientSecret: "...",
            scope: ["email", "profile"]
        }],
        authorizationEndpoint: "https://example.com/oauth/authorize",
        authorizationEndpointQueryParams: { // optional
            "someKey1": "value1",
            "someKey2": null,
        },
        tokenEndpoint: "https://example.com/oauth/token",
        tokenEndpointBodyParams: {
            "someKey1": "value1",
        },
        userInfoEndpoint: "https://example.com/oauth/userinfo",
        userInfoMap: {
            fromUserInfoAPI: {
                userId: "id",
                email: "email",
                emailVerified: "email_verified",
            }
        }
    });

    if (resp.createdNew) {
        // custom provider added to tenant
    } else {
        // existing custom provider config overwritten for tenant
    }
}
```

</BackendTabs.TabItem>
<BackendTabs.TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/multitenancy"
	"github.com/supertokens/supertokens-golang/recipe/thirdparty/tpmodels"
)

func main() {
	tenantId := "..."

	// highlight-start
	resp, err := multitenancy.CreateOrUpdateThirdPartyConfig(tenantId, tpmodels.ProviderConfig{
        ThirdPartyId: "custom",
        Name:         "Custom Provider",
        Clients: []tpmodels.ProviderClientConfig{
            {
                ClientID:     "...",
                ClientSecret: "...",
                Scope:        []string{"email", "profile"},
            },
        },
        AuthorizationEndpoint: "https://example.com/oauth/authorize",
        AuthorizationEndpointQueryParams: map[string]interface{}{ // optional
            "someKey1": "value1",
            "someKey2": nil,
        },
        TokenEndpoint:         "https://example.com/oauth/token",
        TokenEndpointBodyParams: map[string]interface{}{ // optional
            "someKey1": "value1",
        },
        UserInfoEndpoint:      "https://example.com/oauth/userinfo",
        UserInfoMap: tpmodels.TypeUserInfoMap{
            FromUserInfoAPI: struct{UserId string "json:\"userId,omitempty\""; Email string "json:\"email,omitempty\""; EmailVerified string "json:\"emailVerified,omitempty\""} {
                UserId:        "id",
                Email:         "email",
                EmailVerified: "email_verified",
            },
        },
    }, nil)
	// highlight-end

	if err != nil {
		// handle error
	}
	if resp.OK.CreatedNew {
		// Custom provider added to tenant
	} else {
		// Existing custom provider config overwritten for tenant
	}
}
```

</BackendTabs.TabItem>
<BackendTabs.TabItem value="python">

<PythonSyncAsyncCard>
<PythonSyncAsyncCard.Content value="asyncio">

```python
from supertokens_python.recipe.multitenancy.asyncio import create_or_update_third_party_config
from supertokens_python.recipe.thirdparty.provider import ProviderConfig, ProviderClientConfig, UserInfoMap, UserFields

async def some_func():
    tenant_id = "..."
    result = await create_or_update_third_party_config(tenant_id, ProviderConfig(
        third_party_id="custom",
        name="Custom Provider",
        clients=[
            ProviderClientConfig(
                client_id="...",
                client_secret="...",
                scope=["email", "profile"],
            ),
        ],
        authorization_endpoint="https://example.com/oauth/authorize",
        authorization_endpoint_query_params={
            "someKey1": "value1",
            "someKey2": None,
        },
        token_endpoint="https://example.com/oauth/token",
        token_endpoint_body_params={
            "someKey1": "value1",
        },
        user_info_endpoint="https://example.com/oauth/userinfo",
        user_info_map=UserInfoMap(
            from_user_info_api=UserFields(
                user_id="id",
                email="email",
                email_verified="email_verified",
            ),
            from_id_token_payload=UserFields(),
        ),
    ))

    if result.status != "OK":
        print("handle error")
    elif result.created_new:
        print("Custom provider added to tenant")
    else:
        print("Existing custom provider config overwritten for tenant")
```

</PythonSyncAsyncCard.Content>

<PythonSyncAsyncCard.Content value="syncio">

```python
from supertokens_python.recipe.multitenancy.syncio import create_or_update_third_party_config
from supertokens_python.recipe.thirdparty.provider import ProviderConfig, ProviderClientConfig, UserInfoMap, UserFields

tenant_id = "..."
result = create_or_update_third_party_config(tenant_id, ProviderConfig(
    third_party_id="custom",
    name="Custom Provider",
    clients=[
        ProviderClientConfig(
            client_id="...",
            client_secret="...",
            scope=["email", "profile"],
        ),
    ],
    authorization_endpoint="https://example.com/oauth/authorize",
    authorization_endpoint_query_params={
        "someKey1": "value1",
        "someKey2": None,
    },
    token_endpoint="https://example.com/oauth/token",
    token_endpoint_body_params={
        "someKey1": "value1",
    },
    user_info_endpoint="https://example.com/oauth/userinfo",
    user_info_map=UserInfoMap(
        from_user_info_api=UserFields(
            user_id="id",
            email="email",
            email_verified="email_verified",
        ),
        from_id_token_payload=UserFields(),
    ),
))

if result.status != "OK":
    print("handle error")
elif result.created_new:
    print("Custom provider added to tenant")
else:
    print("Existing custom provider config overwritten for tenant")
```

</PythonSyncAsyncCard.Content>
</PythonSyncAsyncCard>

</BackendTabs.TabItem>

<BackendTabs.TabItem value="curl">

```bash
curl --location --request PUT '^{coreInfo.uri}/<TENANT_ID>/recipe/multitenancy/config/thirdparty' \
--header 'api-key: ^{coreInfo.key}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "config": {
        "thirdPartyId": "custom",
        "name": "Custom provider",
        "clients": [{
            "clientId": "...",
            "clientSecret": "...",
            "scope": ["email", "profile"]
        }],
        "authorizationEndpoint": "https://example.com/oauth/authorize",
        "authorizationEndpointQueryParams": {
            "someKey1": "value1",
            "someKey2": "value2"
        },
        "tokenEndpoint": "https://example.com/oauth/token",
        "tokenEndpointBodyParams": {
            "someKey1": "value1"
        },
        "userInfoEndpoint": "https://example.com/oauth/userinfo",
        "userInfoMap": {
            "fromUserInfoAPI": {
                "userId": "id",
                "email": "email",
                "emailVerified": "email_verified"
            }
        }
    }
}'
```

</BackendTabs.TabItem>

<BackendTabs.TabItem value="dashboard">

Click on **Add new provider** in the Social/Enterprise Providers section

<img src="/img/dashboard/tenant-management/third-party-providers.png" alt="Social/Enterprise providers"/>

Select **Add Custom Provider** option

<img src="/img/dashboard/tenant-management/new-provider.png" alt="New Provider"/>

Fill in the details as shown below and click on **Save**

<img src="/img/dashboard/tenant-management/new-oauth-provider.png" alt="OAuth2 provider"/>

</BackendTabs.TabItem>

</BackendTabs>

- You can see all the options in the [CDI documentation](https://supertokens.com/docs/cdi).

- The `tenantId` is a unique ID that identifies the tenant for whom you want to add the custom provider. If not specified, it adds it for the `"public"` `tenantId` (which is the default one).

- The `thirdPartyId` is a unique ID for this provider which helps SuperTokens identify the provider. For example, the `thirdPartyId` for the built in Google provider is `"google"`.
- The `name` field goes to the frontend and can render the login button on the frontend UI. For example, if you set the `name` to `"XYZ"`, the pre-built UI on the frontend displays the text `"Login using XYZ"` on the button for this provider.
- The `clients` array represents the client credentials / settings for each of your frontend clients. Most of the time, one client item is enough, but if the provider requires using different client ID / secret for web vs mobile apps, you would need to add two items to this array - one for web, and one for mobile. In this case, you would also need to add the `clientType: string` configuration for each of the items in the `clients` array.
- `AuthorizationEndpoint` corresponds to the URL to which the user should go for the login. For example for Google, this is `"https://accounts.google.com/o/oauth2/v2/auth"`.
    - `AuthorizationEndpointQueryParams` is an optional configuration, but it can modify the query params added to the `AuthorizationEndpoint`. You can use this configuration to add new keys, or to modify or remove (by setting to null) query params added by SuperTokens.
- `TokenEndpoint` corresponds to the API that exchanges Authorization Code for the user's Access Token or the ID Token. For example for Google, the value of this is `"https://oauth2.googleapis.com/token"`.
    - `TokenEndpointBodyParams` is an optional configuration, but it can modify the request body sent to the `TokenEndpoint`. You can use this configuration to add new keys, or to modify or remove (by setting to null) body params added by SuperTokens.
- `UserInfoEndpoint` corresponds to the API that provides user information using the AccessToken. For Google, the value of this is `"https://www.googleapis.com/oauth2/v1/userinfo"`. Once this endpoint is accessed, SuperTokens fetches user info (like their userID and email ID) from the JSON response based on the configuration for `UserInfoMap.FromUserInfoAPI` map. For example, the value of the map for Google is:
    ```text
    {
        userId: "id",
        email: "email",
        emailVerified: "email_verified"
    }
    ```

This means that when SuperTokens gets back the JSON from the `/userinfo` endpoint, it reads the `jsonResponse.id` field to get the user's Google ID. It reads the `jsonResponse.email` field to get back the user's email and the `jsonResponse.email_verified` field to know if the user's email is verified or not.

If you want to fetch a value from a nested JSON object, you can specify something like `userId: "user.id"`, in which case the provider's user ID is fetched using `jsonResponse.user.id`.

## Via Open ID Connect (OIDC) Endpoints

If the provider is Open ID Connect (OIDC) compatible, you can provide a URL for the `OIDCDiscoverEndpoint` configuration. The backend SDK automatically discovers authorization endpoint, token endpoint and the user info endpoint by querying the `<OIDCDiscoverEndpoint>/.well-known/openid-configuration`.

Below is an example of how to set the OIDC discovery endpoint:

<BackendTabs additionalValues={[{ value: "dashboard", label: "Dashboard"}, { value: "curl", label: "cURL"}]}>
<BackendTabs.TabItem value="nodejs">

```tsx
import Multiteancy from "supertokens-node/recipe/multitenancy";

async function createTenant() {
    let resp = await Multiteancy.createOrUpdateThirdPartyConfig("customer1", {
        thirdPartyId: "custom",
        name: "Custom Provider",
        clients: [{
            clientId: "...",
            clientSecret: "...",
            scope: ["email", "profile"]
        }],
        // highlight-start
        oidcDiscoveryEndpoint: "https://example.com/.well-known/openid-configuration",
        // highlight-end
        authorizationEndpointQueryParams: { // optional
            "someKey1": "value1",
            "someKey2": null,
        },
        userInfoMap: {
            fromIdTokenPayload: {
                userId: "id",
                email: "email",
                emailVerified: "email_verified",
            }
        }
    });

    if (resp.createdNew) {
        // custom provider added to tenant
    } else {
        // existing custom provider config overwritten for tenant
    }
}
```

</BackendTabs.TabItem>
<BackendTabs.TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/multitenancy"
	"github.com/supertokens/supertokens-golang/recipe/thirdparty/tpmodels"
)

func main() {
	tenantId := "..."

	resp, err := multitenancy.CreateOrUpdateThirdPartyConfig(tenantId, tpmodels.ProviderConfig{
        ThirdPartyId: "custom",
        Name:         "Custom provider",
        Clients: []tpmodels.ProviderClientConfig{
            {
                ClientID:     "...",
                ClientSecret: "...",
                Scope:        []string{"profile", "email"},
            },
        },
        // highlight-start
        OIDCDiscoveryEndpoint: "https://example.com/.well-known/openid-configuration",
        // highlight-end
        AuthorizationEndpointQueryParams: map[string]interface{}{ // optional
            "someKey1": "value1",
            "someKey2": nil,
        },
        UserInfoMap: tpmodels.TypeUserInfoMap{
            FromIdTokenPayload: struct{UserId string "json:\"userId,omitempty\""; Email string "json:\"email,omitempty\""; EmailVerified string "json:\"emailVerified,omitempty\""} {
                UserId:        "id",
                Email:         "email",
                EmailVerified: "email_verified",
            },
        },
    }, nil)

	if err != nil {
		// handle error
	}
	if resp.OK.CreatedNew {
		// Custom provider added to tenant
	} else {
		// Existing custom provider config overwritten for tenant
	}
}
```

</BackendTabs.TabItem>
<BackendTabs.TabItem value="python">

```python
from supertokens_python.recipe.multitenancy.asyncio import create_or_update_third_party_config
from supertokens_python.recipe.thirdparty.provider import ProviderConfig, ProviderClientConfig, UserInfoMap, UserFields

async def some_func():
    tenant_id = "..."
    result = await create_or_update_third_party_config(tenant_id, ProviderConfig(
        third_party_id="custom",
        name="Custom Provider",
        clients=[
            ProviderClientConfig(
                client_id="...",
                client_secret="...",
                scope=["email", "profile"],
            ),
        ],
        # highlight-start
        oidc_discovery_endpoint="https://example.com/.well-known/openid-configuration",
        # highlight-end
        authorization_endpoint_query_params={
            "someKey1": "value1",
            "someKey2": None,
        },
        user_info_map=UserInfoMap(
            from_user_info_api=UserFields(),
            from_id_token_payload=UserFields(
                user_id="id",
                email="email",
                email_verified="email_verified",
            ),
        ),
    ))

    if result.status != "OK":
        print("handle error")
    elif result.created_new:
        print("Custom provider added to tenant")
    else:
        print("Existing custom provider config overwritten for tenant")
```

</BackendTabs.TabItem>

<BackendTabs.TabItem value="curl">

```bash
curl --location --request PUT '^{coreInfo.uri}/<TENANT_ID>/recipe/multitenancy/config/thirdparty' \
--header 'api-key: ^{coreInfo.key}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "config": {
        "thirdPartyId": "custom",
        "name": "Custom provider",
        "clients": [{
            "clientId": "...",
            "clientSecret": "...",
            "scope": ["email", "profile"]
        }],
        "oidcDiscoveryEndpoint": "https://example.com/.well-known/openid-configuration",
        "authorizationEndpointQueryParams": {
            "someKey1": "value1",
            "someKey2": "value2"
        },
        "userInfoMap": {
            "fromIdTokenPayload": {
                "userId": "id",
                "email": "email",
                "emailVerified": "email_verified"
            }
        }
    }
}'
```

</BackendTabs.TabItem>

<BackendTabs.TabItem value="dashboard">

Click on **Add new provider** in the Social/Enterprise Providers section

<img src="/img/dashboard/tenant-management/third-party-providers.png" alt="Social/Enterprise providers"/>

Select **Add Custom Provider** option

<img src="/img/dashboard/tenant-management/new-provider.png" alt="New Provider"/>

Fill in the details as shown below and click on **Save**

<img src="/img/dashboard/tenant-management/new-oidc-provider.png" alt="OAuth2 provider"/>

</BackendTabs.TabItem>

</BackendTabs>

- You can see all the options in the [CDI documentation](https://supertokens.com/docs/cdi).

- The `tenantId` is a unique ID that identifies the tenant for whom you want to add the custom provider. If not specified, it adds it for the `"public"` `tenantId` (which is the default one).

- The configuration values are similar to the ones in the "Via OAuth endpoints" method. Please read that section to understand the `thirdPartyId`, `name`, `clients` configuration.
- Unlike the "Via OAuth endpoints", the user's info is extracted from the ID token payload using the configuration specified by you in the `UserInfoMap.FromIdTokenPayload` map.
- You can also add the `UserInfoMap.FromUserInfoAPI` map as done in the "Via OAuth endpoints" section. SuperTokens auto merges the user information.
