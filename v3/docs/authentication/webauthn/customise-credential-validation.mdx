---
title: Customise Credential Validation
hide_title: true
sidebar_position: 3
---

# Customise Credential Validation

## Overview

The WebAuthN flow allows the user to customise the way credentials are generated and validated. The reason for this is that certain use-cases require the user to have a lot of control over the credential generation and validation process.

For example, in the case of a banking app, the user may want to use a YubiKey to generate and validate credentials. In this case, the user may want to use a required PIN or a biometric factor to validate the credential.

Most of the customisation is done through function overrides. You can find more details about how they work here: [Overrides](/docs/references/sdks/functions-overrides/backend-functions-override).

## Recipe Configuration

The recipe configuration is done by the `init` function. You can find more details about the recipe configuration here: [Recipe Configuration](https://supertokens.com/docs/nodejs/modules/recipe_webauthn.html#init).

When configuring the recipe, you can pass the following options:

| Option | Key Name | Description | Default Value |
|--------|----------|-------------|---------------|
| Relying Party ID | `getRelyingPartyId` | The domain name of your application that will be shown to the user during authentication | API domain (`apiBasePath`) |
| Relying Party Name | `getRelyingPartyName` | The display name of your application that will be shown to the user during authentication | Application name (`appName`) |
| Origin | `getOrigin` | The origin URL that the credential is generated on | Origin of the request |

All of the above options are optional and if not provided, the recipe will use the default values. For more details on the default values, please refer to the [Recipe Configuration](https://supertokens.com/docs/nodejs/modules/recipe_webauthn.html#init) documentation.

```ts
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import WebAuthn from "supertokens-node/recipe/webauthn";

supertokens.init({
    framework: "express",
    supertokens: {
        // https://try.supertokens.com is for demo purposes. Replace this with the address of your core instance (sign up on supertokens.com), or self host a core.
        connectionURI: "https://try.supertokens.com",
        // apiKey: <API_KEY(if configured)>,
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "<YOUR_APP_NAME>",
        apiDomain: "<YOUR_API_DOMAIN>",
        websiteDomain: "<YOUR_WEBSITE_DOMAIN>",
        apiBasePath: "/auth",
        websiteBasePath: "/auth"
    },
    recipeList: [
        WebAuthn.init({
            getOrigin: () => {
                return "https://example.com";
            },
            getRelyingPartyId: () => {
                return "example.com";
            },
            getRelyingPartyName: () => {
                return "example";
            },
        }),
        Session.init() // initializes session features
    ]
});
```

## Customising Credential Generation

The credentials are generated by the client (if it supports it). You can find more details about the way the browser handles credential generation here: [Credential Management API](https://developer.mozilla.org/en-US/docs/Web/API/Credential_Management_API).

The credential is generated based on a set of options that you can pass to the `navigator.credentials.create` function. In our case these options are generated on the server through the SDK.

The possible configurable options are:

| Option | Key Name | Description | Default Value |
|--------|----------|-------------|---------------|
| Relying Party ID | `relyingPartyId` | The domain name of your application that will be shown to the user during authentication. | API domain (`apiBasePath`) |
| Relying Party Name | `relyingPartyName` | The display name of your application that will be shown to the user during authentication. | Application name (`appName`) |
| Origin | `origin` | The origin URL that the credential is generated on. | Origin of the request |
| Timeout | `timeout` | The time in milliseconds that the user has to complete the credential generation process. | `6000` |
| Attestation | `attestation` | Controls how much information about the authenticator is included in the attestation statement. This controls what authenticators are supported. | `none` |
| Supported Algorithms | `supportedAlgorithms` | The cryptographic algorithms that can be used for generating credentials. Different authenticators support different algorithms. | `[-8, -7, -257]` |
| Resident Key | `residentKey` | Whether the credential should be stored on the authenticator device. | `required` |
| User Verification | `userVerification` | Controls whether user verification (like PIN or biometrics) is required. | `preferred` |
| User Display Name | `displayName` | The display name of the user. | `email` field |

Below is an example of how you can customise the credential generation options.

```ts
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import WebAuthn from "supertokens-node/recipe/webauthn";

supertokens.init({
    framework: "express",
    supertokens: {
        // https://try.supertokens.com is for demo purposes. Replace this with the address of your core instance (sign up on supertokens.com), or self host a core.
        connectionURI: "https://try.supertokens.com",
        // apiKey: <API_KEY(if configured)>,
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "<YOUR_APP_NAME>",
        apiDomain: "<YOUR_API_DOMAIN>",
        websiteDomain: "<YOUR_WEBSITE_DOMAIN>",
        apiBasePath: "/auth",
        websiteBasePath: "/auth"
    },
    recipeList: [
        WebAuthn.init({
            override: {
                functions: (originalImplementation) => {
                    return {
                        ...originalImplementation,
                        registerOptions: (input) => {
                            return originalImplementation.registerOptions({
                                ...input,
                                attestation: "direct",
                                residentKey: "required",
                                timeout: 10 * 1000,
                                userVerification: "required",
                                displayName: "John Doe",
                                supportedAlgorithms: [-257],
                                relyingPartyId: 'example.com',
                                relyingPartyName: 'example',
                                origin: 'https://example.com',
                            });
                        },
                    };
                },
            },
        }),
        Session.init() // initializes session features
    ]
});
```

## Customising Credential Validation

When a user attempts to login using a WebAuthN credential, the credential is used for signing a challenge through the client using `navigator.credentials.get` function. The options for signing the challenge are generated on the server through the SDK and defined how the authentication will take place:

| Option | Key Name | Description | Default |
|--------|----------|-------------|---------|
| **Relying Party ID** | `relyingPartyId` | The domain name of your application that will be used for validating the credential. | - |
| **Relying Party Name** | `relyingPartyName` | The human-readable name of your application. | - |
| **Origin** | `origin` | The origin URL that the credential is generated on. | Origin of the request |
| **Timeout** | `timeout` | The time in milliseconds that the user has to complete the credential validation process. | `6000` |
| **User Verification** | `userVerification` | Controls whether user verification (like PIN or biometrics) is required. | `preferred` |

Below is an example of how you can customise the credential generation options.

```ts
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import WebAuthn from "supertokens-node/recipe/webauthn";

supertokens.init({
    framework: "express",
    supertokens: {
        // https://try.supertokens.com is for demo purposes. Replace this with the address of your core instance (sign up on supertokens.com), or self host a core.
        connectionURI: "https://try.supertokens.com",
        // apiKey: <API_KEY(if configured)>,
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "<YOUR_APP_NAME>",
        apiDomain: "<YOUR_API_DOMAIN>",
        websiteDomain: "<YOUR_WEBSITE_DOMAIN>",
        apiBasePath: "/auth",
        websiteBasePath: "/auth"
    },
    recipeList: [
        WebAuthn.init({
            override: {
                functions: (originalImplementation) => {
                    return {
                        ...originalImplementation,
                        signInOptions: (input) => {
                            return originalImplementation.signInOptions({
                                ...input,
                                timeout: 10 * 1000,
                                userVerification: "required",
                                relyingPartyId: 'example.com',
                                origin: 'https://example.com',
                            });
                        },
                    };
                },
            },
        }),
        Session.init() // initializes session features
    ]
});
```
