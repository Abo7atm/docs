---
id: backup-codes
title: Implementing backup codes
hide_title: true
show_ui_switcher: true
---

import {PreBuiltOrCustomUISwitcher, PreBuiltUIContent, CustomUIContent} from "/src/components/preBuiltOrCustomUISwitcher"

# Implementing backup codes

Backup codes is one of the ways in which end users can recover their account in case they loose their second factor device. At the moment, SuperTokens does not have an in built implementation for backup codes, however, you can customise our SDKs to add this feature. This guide will show you how to implement backup codes in your application.

:::note
[Here is an example](https://github.com/supertokens/supertokens-auth-react/tree/master/examples/with-multifactorauth-recovery-codes) of how you can implement backup codes in your application if you are using our pre built UI.
:::

## How it works
We allow users to generate a backup code after they have setup MFA. This backup code will be associated with their userID in their user metadata JSON. Once users want to use their backup code, we show them a UI to enter their code which calls an API that verifies the backup code and adds a flag in their session indicating that they have correctly supplied a backup code. Post that, we use this flag to allow users to create a new MFA device (for example a new TOTP device), even if they already have one registered on their account. User can then go about adding a new device and completing MFA using that.

## Step 1: Adding an API to generate backup codes on the backend

Here is an [example API](https://github.com/supertokens/supertokens-auth-react/blob/feat/mfa/base/examples/with-multifactorauth-recovery-codes/backend/index.ts#L52) for how you can create a recovery code. In here, we create a secure random string, and save the hashed version in the user metadata JSON. This API returns the plain text recovery code to the frontend to display to the user.

## Step 2: Allowing users to generate a backup code when they finish MFA setup

<PreBuiltOrCustomUISwitcher>

<PreBuiltUIContent>

After the user has successfully setup their second factor (during sign up or during recovery process), we navigate them to a page which shows them their backup code. 

We can navigate them to this page by [overriding the `getRedirectURL` function](TODO) and taking them there if it's a successful sign up or if we just created a new MFA device. 

Once on the page, the UI calls the API we created in the previous step to create a new recovery code for the user. Note that calling this API will replace the older recovery code, but of course, this it's all custom, you can change the logic.

[Here is an example](TODO) of how to implement this page.

</PreBuiltUIContent>

<CustomUIContent>

For custom UI, the UI for where and how you show the recovery code page is up to you. We recommend showing the user this page post sign up, or whenever they create a new MFA device successfully.

Once on the page, the UI calls the API we created in the previous step to create a new recovery code for the user. Note that calling this API will replace the older recovery code, but of course, this it's all custom, you can change the logic.

[Here is an example](TODO) of how to implement this page.

</CustomUIContent>

</PreBuiltOrCustomUISwitcher>

## Step 3: Showing users UI to use their backup code on the MFA challenge UI

## Step 4: Modifying the user's session to mark that they have verified their backup code

## Step 5: Force allowing users to setup a new device