---
id: automatic-account-linking
title: Automatic account linking
hide_title: true
---

<!-- COPY DOCS -->
<!-- ./thirdpartyemailpassword/common-customizations/account-linking/automatic-account-linking.mdx -->

import MultiTenancyPaidBanner from '../../../community/reusableMD/multitenancy/MultiTenancyPaidBanner.mdx'
import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";

<MultiTenancyPaidBanner />

# Automatic account linking

Automatic account linking is a feature that allows users to automatically sign in to their existing account using more than one login method. On a high level, the accounts for the different login methods are linked automatically by SuperTokens provided that:
- Their emails or phone numbers are the same.
- Their emails or phone numbers are verified.

SuperTokens ensures that accounts are automatically linked only if there is [no risk of account takeover](./security-considerations).

## Enabling automatic account linking

You can enable this feature by providing the following callback implementation on the backend SDK:

<BackendSDKTabs>
<TabItem value="nodejs">

```tsx
import supertokens, { User } from "supertokens-node";
import AccountLinking from "supertokens-node/recipe/accountlinking";
import { AccountInfoWithRecipeId } from "supertokens-node/recipe/accountlinking/types";

supertokens.init({
    supertokens: {
        connectionURI: "<CONNECTION_URI_HERE_FROM_THE_POPUP>",
        apiKey: "<API_KEY_HERE_FROM_THE_POPUP>"
    },
    appInfo: {
        apiDomain: "...",
        appName: "...",
        websiteDomain: "..."
    },
    recipeList: [
        // highlight-start
        AccountLinking.init({
            shouldDoAutomaticAccountLinking: async (newAccountInfo: AccountInfoWithRecipeId, user: User | undefined, tenantId: string, userContext: any) => {
                return {
                    shouldAutomaticallyLink: true,
                    shouldRequireVerification: true
                }
            }
        })
        // highlight-end
    ]
});
```

</TabItem>
<TabItem value="go">

:::note
Coming Soon
:::

</TabItem>
<TabItem value="python">

:::note
Coming Soon
:::

</TabItem>
</BackendSDKTabs>

#### Input args meaning:
- `newAccountInfo: AccountInfoWithRecipeId`: This object contains information about the user whose account is going to be linked, or will become a primary user. The object contains the user's email, social login info and phone number (whichever they used to sign in / up with). It also contains the login method (`emailpassword`, `thirdparty`, or `passwordless`).
- `user: User | undefined`: If this is not `undefined`, it means that `newAccountInfo` user is about to linked to this `user`. If this is `undefined`, it means that `newAccountInfo` user is about to become a primary user.
- `tenant: string`: The ID of the tenant that the user is signing in / up to.
- `userContext: any`: User defined userContext.

#### Output args meaning:
- `shouldAutomaticallyLink`: If this is `true`, it means that the `newAccountInfo` will be linked or will become a primary user during this API call (assuming a set of security checks pass). If this is `false`, it means that there will be no account linking related operation during this API call.
- `shouldRequireVerification`: If this is `true`, that account linking operations will only happen if the `newAccountInfo` is verified. **We strongly recommend keeping it set to `true` for security reasons.**

You can use the input of the function to dynamically decide if you want to do account linking for a particular user and / or login method or not.

## Different scenarios of automatic account linking

- **During sign up**: If there exists another account with the same email or phone number within the current tenant, the new account will be linked to the existing account if:
    - The existing account is a primary user
    - If `shouldRequireVerification` is `true`, the new account needs to be created via a method that has the email as verified (for example via passwordless or google login). If the new method doesn't inherently verify the email (like in email password login), the the accounts will be linked post email verification.
    - Your implementation for `shouldDoAutomaticAccountLinking` returns `true` for `shouldAutomaticallyLink`.

- **During sign in**: If the current user is not already linked and if there exists another user with the same email or phone number within the current tenant, the accounts will be linked if:
    - The user being signed into is NOT a primary user, and the other user with the same email / phone number IS a primary user
    - If `shouldRequireVerification` is `true`, the current account (that's being signed into) has its email as verified.
    - Your implementation for `shouldDoAutomaticAccountLinking` returns `true` for `shouldAutomaticallyLink`.

- **After email verification**: If the current user whose email got verified is not a primary user, and there exists another primary user in the same tenant with the same email, then we link the two accounts if:
    - TODO

- **During password reset flow**: If there already exists a user with the same email in a non email password recipe (social login for example), and the user is doing a password reset flow, a new email password user is created and linked to the existing account if:
    - TODO

## Migration of user data when accounts are linked
TODO

## Support status codes
TODO

