---
title: Machine to Machine Authentication
hide_title: true
---

# Machine to Machine Authentication

You can use the following guide if you want to implement a custom authentication flow between your microservices.

## 1. Set Up Your Authentication Service 

:::note
TODO: Add actual code snippets here
:::

First, initialize and setup **SuperTokens** in your `authentication service`.

## 2. Initialize the OAuth2Provider

In addition to the authentication recipes youâ€™ve set up, initialize the `OAuth2Provider` recipe in your `authentication backend`.

```typescript
import supertokens from "supertokens-node";
import OAuth2Provider from"supertokens-node/recipe/oauth2provider";

supertokens.init({
    framework: "express",
    supertokens: {
        connectionURI: "<YOUR_CONNECTION_URI>",
        apiKey: "<YOUR_API_KEY>",
    },
    appInfo: {
        appName: "",
        apiDomain: "<YOUR_API_DOMAIN>",
        websiteDomain: "<YOUR_WEBSITE_DOMAIN>",
        apiBasePath: "/auth",
        websiteBasePath: "/auth"
    },
    recipeList: [
        // This is where you initialize the OAuth2 recipe
        OAuth2Provider.init(),
    ]
});
```

## 3. Add a Way to Create OAuth2 Clients 

We have to create OAuth2 clients in order to allow them to authenticate through our flow.

First we need to add a method to do this.
Our recommendation is to use the `createOAuth2Client` function that is exposed by our SDK.
Alternatively, you can also directly call the **SuperTokens** core API.

### Using the `createOAuth2Client` function

:::note 
TODO: Add details about what each parameter means
:::

```typescript
import { createOAuth2Client } from "supertokens-node/recipe/oauth2provider";

createClient({
  clientName: 'My Application',
  grantTypes: ["client_credentials"],
});
 
```

### Using the Core API 

```bash
curl -X POST https://<CORE_SERVICE_DOMAIN>/recipe/oauth2/admin/clients \
-H "Content-Type: application/json" \
-d '{
  "client_name": "My Application",
  "grant_types": ["client_credentials"]
}'
```

## 4. Create Separate Clients for Each Application

Using the method that we defined in the previous step create separate clients for each of your `backend services`.

Repeat the process for each domain, adjusting the `clientName` as necessary.

## 5. Create Tokens

To generate tokens for your microservices using the `client_credentials` grant type, use the following code snippet:

:::note
Not sure on how scope should look like
:::

```typescript
fetch('https://api.auth.example.com/auth/oauth/token', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      client_id: "<YOUR_CLIENT_ID>",
      client_secret: "<YOUR_CLIENT_SECRET>",
      grant_type: 'client_credentials',
      scope: ["<YOUR_REQUIRED_SCOPE>"],
    }),
});
```


