---
sidebar_position: 2
title: Frontend Setup
hide_title: true
---

# Setting up the Frontend

Setting up the frontend is relatively simple. You need to generate a request ID for each authentication event attempt. This request ID is used as a parameter for the anomaly detection.

### Generating a Request ID on the Frontend

In order to generate a request ID, you need to import and initialise the SDK using your public API key. This SDK is used to generate a unique request ID for each authentication event attempt.

Below is an example of how to implement request ID generation on your frontend:

```typescript
const API_KEY = "<api-key>"; // Your public API key that you received from the SuperTokens team
const SDK_URL = "https://supertokens.io/t8gl82qb5Wnm8q5x/qZXhulAxLVoSmiDd";
const supertokensDeviceIdPromise = require(SDK_URL + "?apiKey=" + API_KEY).then((DeviceId: any) => DeviceId.load({
    endpoint: [
        SDK_URL,
        DeviceId.defaultEndpoint
    ]
}));

async function getRequestId() {
    const deviceId = await supertokensDeviceIdPromise;
    const result = await deviceId.get();
    return result.requestId;
}
```

### Passing the Request ID to the Backend

Once you have generated the request ID on the frontend, you need to pass it to the backend. This is done by including the `requestId` property along with the value as part of the preAPIHook body from the initialisation of the recipes.

:::important
If the request ID is not passed to the backend, the anomaly detection will only be able to detect password breaches and brute force attacks.
:::

```typescript
const preAPIHook = async (context) => {
    let url = context.url;
    let requestInit = context.requestInit;

    let action = context.action;
    if (action === "EMAIL_PASSWORD_SIGN_IN" || action === "EMAIL_PASSWORD_SIGN_UP" || action === "SEND_RESET_PASSWORD_EMAIL") {
        let requestId = await getRequestId();
        let body = context.requestInit.body;
        if (body !== undefined) {
            let bodyJson = JSON.parse(body as string);
            
            bodyJson.requestId = requestId;
            
            requestInit.body = JSON.stringify(bodyJson);
        }
    }

    return {
        requestInit, url
    };
}
```

Below is a full example of how to initialise the SDK and pass the request ID to the backend:
```typescript
import EmailPassword from "supertokens-auth-react/recipe/emailpassword";
import ThirdParty from "supertokens-auth-react/recipe/thirdparty";
import Passwordless from "supertokens-auth-react/recipe/passwordless";
import { EmailPasswordPreBuiltUI } from "supertokens-auth-react/recipe/emailpassword/prebuiltui";
import { ThirdPartyPreBuiltUI } from "supertokens-auth-react/recipe/thirdparty/prebuiltui";
import { PasswordlessPreBuiltUI } from "supertokens-auth-react/recipe/passwordless/prebuiltui";
import Session from "supertokens-auth-react/recipe/session";
import Multitenancy from "supertokens-auth-react/recipe/multitenancy";
import TOTP from "supertokens-auth-react/recipe/totp";
import { TOTPPreBuiltUI } from "supertokens-auth-react/recipe/totp/prebuiltui"
import MultiFactorAuth from "supertokens-auth-react/recipe/multifactorauth"
import EmailVerification from "supertokens-auth-react/recipe/emailverification"
import { EmailVerificationPreBuiltUI } from "supertokens-auth-react/recipe/emailverification/prebuiltui"
import { MultiFactorAuthPreBuiltUI } from "supertokens-auth-react/recipe/multifactorauth/prebuiltui"

const API_KEY = "<api-key>"; // Your public API key that you received from the SuperTokens team
const SDK_URL = "https://supertokens.io/t8gl82qb5Wnm8q5x/qZXhulAxLVoSmiDd";
const supertokensDeviceIdPromise = require(SDK_URL + "?apiKey=" + API_KEY).then((DeviceId: any) => DeviceId.load({
    endpoint: [
        SDK_URL,
        DeviceId.defaultEndpoint
    ]
}));

async function getRequestId() {
    const deviceId = await supertokensDeviceIdPromise;
    const result = await deviceId.get();
    return result.requestId;
}

export function getApiDomain() {
    const apiPort = process.env.REACT_APP_API_PORT || 3001;
    const apiUrl = process.env.REACT_APP_API_URL || `http://localhost:${apiPort}`;
    return apiUrl;
}

export function getWebsiteDomain() {
    const websitePort = process.env.REACT_APP_WEBSITE_PORT || 3000;
    const websiteUrl = process.env.REACT_APP_WEBSITE_URL || `http://localhost:${websitePort}`;
    return websiteUrl;
}

export const styleOverride = `
[data-supertokens~=tenants-link] {
    margin-top: 8px;
}
`;

const preAPIHook = async (context) => {
    let url = context.url;
    let requestInit = context.requestInit;

    let action = context.action;
    if (action === "EMAIL_PASSWORD_SIGN_IN" || action === "EMAIL_PASSWORD_SIGN_UP" || action === "SEND_RESET_PASSWORD_EMAIL") {
        let requestId = await getRequestId();
        let body = context.requestInit.body;
        if (body !== undefined) {
            let bodyJson = JSON.parse(body as string);
            
            bodyJson.requestId = requestId;
            
            requestInit.body = JSON.stringify(bodyJson);
        }
    }

    return {
        requestInit, url
    };
}

export const SuperTokensConfig = {
    appInfo: {
        appName: "SuperTokens Demo App",
        apiDomain: getApiDomain(),
        websiteDomain: getWebsiteDomain(),
    },
    usesDynamicLoginMethods: true,
    style: styleOverride,
    // recipeList contains all the modules that you want to
    // use from SuperTokens. See the full list here: https://supertokens.com/docs/guides
    recipeList: [
        EmailPassword.init({
            preAPIHook,
        }),
        Passwordless.init({
            contactMethod: "EMAIL_OR_PHONE",
        }),
        ThirdParty.init(),
        Session.init(),
        Multitenancy.init({
            override: {
                functions: (oI) => {
                    return {
                        ...oI,
                        getTenantId: async () => {
                            const tenantIdInStorage = localStorage.getItem("tenantId");
                            return tenantIdInStorage === null ? undefined : tenantIdInStorage;
                        },
                    };
                },
            },
        }),
        TOTP.init(),
        MultiFactorAuth.init(),
        EmailVerification.init({
            mode: "REQUIRED"
        })
    ],
};

export const recipeDetails = {
    docsLink: "https://supertokens.com/docs/multitenancy/introduction",
};

export const PreBuiltUIList = [EmailPasswordPreBuiltUI, ThirdPartyPreBuiltUI, PasswordlessPreBuiltUI, TOTPPreBuiltUI, EmailVerificationPreBuiltUI, MultiFactorAuthPreBuiltUI];
```